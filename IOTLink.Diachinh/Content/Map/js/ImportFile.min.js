var ImportFile={GLOBAL:{FileData:null,stringData:null,objectData:null},CONSTS:{},SELECTORS:{modalFile:"#textfileModal",Input_File:"input[name='Files']",TxtFileUploadError:".fileUpLoadError",fileNames:".fileNames",closeModal:".close-modal-importfile",btnUploadFile:"#btn-upload-file"},init:function(){ImportFile.setEvent()},setEvent:function(){$(ToolShape.SELECTORS.btnUpdateFile).on("click",function(){$(ImportFile.SELECTORS.modalFile).modal("show")});$(ImportFile.SELECTORS.closeModal).on("click",function(){$(ImportFile.SELECTORS.modalFile).modal("hide");$(ImportFile.SELECTORS.Input_File).val("");$(ImportFile.SELECTORS.TxtFileUploadError).text("");$(ImportFile.SELECTORS.fileNames).text("")});$(ImportFile.SELECTORS.btnUploadFile).on("click",function(n){var t,i;if($(ImportFile.SELECTORS.Input_File)[0].files.length>0){for(arrayfile=[],t=0;t<ImportFile.GLOBAL.objectData.features.length;t++)i={id:ImportFile.GLOBAL.objectData.features[t].properties.Id==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.Id,objectId:ImportFile.GLOBAL.objectData.features[t].properties.ObjectId==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.ObjectId,index:ImportFile.GLOBAL.objectData.features[t].properties.Index==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.Index,uuid:ImportFile.GLOBAL.objectData.features[t].properties.UUID==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.UUID,thoiDiemBatDau:ImportFile.GLOBAL.objectData.features[t].properties.ThoiDiemBatDau==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.ThoiDiemBatDau,thoiDiemKetThuc:ImportFile.GLOBAL.objectData.features[t].properties.ThoiDiemKetThuc==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.ThoiDiemKetThuc,maXa:ImportFile.GLOBAL.objectData.features[t].properties.MaXa==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.MaXa,maDoiTuong:ImportFile.GLOBAL.objectData.features[t].properties.MaDoiTuong==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.MaDoiTuong,soHieuToBanDo:ImportFile.GLOBAL.objectData.features[t].properties.SoHieuToBanDo==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.SoHieuToBanDo,soThuTuThua:ImportFile.GLOBAL.objectData.features[t].properties.SoThuTuThua==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.SoThuTuThua,soHieuToBanDoCu:ImportFile.GLOBAL.objectData.features[t].properties.SoHieuToBanDoCu==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.SoHieuToBanDoCu,soThuTuThuaCu:ImportFile.GLOBAL.objectData.features[t].properties.SoThuTuThuaCu==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.SoThuTuThuaCu,dienTich:ImportFile.GLOBAL.objectData.features[t].properties.DienTich==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.DienTich,dienTichPhapLy:ImportFile.GLOBAL.objectData.features[t].properties.DienTichPhapLy==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.DienTichPhapLy,kyHieuMucDichSuDung:ImportFile.GLOBAL.objectData.features[t].properties.KyHieuMucDichSuDung==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.KyHieuMucDichSuDung,kyHieuDoiTuong:ImportFile.GLOBAL.objectData.features[t].properties.KyHieuDoiTuong==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.KyHieuDoiTuong,tenChu:ImportFile.GLOBAL.objectData.features[t].properties.TenChu==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.TenChu,diaChi:ImportFile.GLOBAL.objectData.features[t].properties.DiaChi==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.DiaChi,daCapGCN:ImportFile.GLOBAL.objectData.features[t].properties.DaCapGCN==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.DaCapGCN,tenChu2:ImportFile.GLOBAL.objectData.features[t].properties.TenChu2==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.TenChu2,namSinhC1:ImportFile.GLOBAL.objectData.features[t].properties.NamSinhC1==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.namSinhC1,soHieuGCN:ImportFile.GLOBAL.objectData.features[t].properties.SoHieuGCN==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.soHieuGCN,soVaoSo:ImportFile.GLOBAL.objectData.features[t].properties.SoVaoSo==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.SoVaoSo,ngayVaoSo:ImportFile.GLOBAL.objectData.features[t].properties.NgayVaoSo==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.NgayVaoSo,soBienNhan:ImportFile.GLOBAL.objectData.features[t].properties.SoBienNhan==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.SoBienNhan,nguoiNhanHS:ImportFile.GLOBAL.objectData.features[t].properties.NguoiNhanHS==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.NguoiNhanHS,coQuanThuLy:ImportFile.GLOBAL.objectData.features[t].properties.CoQuanThuLy==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.CoQuanThuLy,loaiHS:ImportFile.GLOBAL.objectData.features[t].properties.LoaiHS==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.LoaiHS,maLienKet:ImportFile.GLOBAL.objectData.features[t].properties.MaLienKet==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.MaLienKet,shapeSTArea:ImportFile.GLOBAL.objectData.features[t].properties.ShapeSTArea==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.ShapeSTArea,shapeSTLength:ImportFile.GLOBAL.objectData.features[t].properties.ShapeSTLength==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.ShapeSTLength,shapeLength:ImportFile.GLOBAL.objectData.features[t].properties.ShapeLength==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.ShapeLength,shapeArea:ImportFile.GLOBAL.objectData.features[t].properties.ShapeArea==undefined?0:ImportFile.GLOBAL.objectData.features[t].properties.ShapeArea,geometry:ImportFile.GLOBAL.objectData.features[t].geometry==undefined?null:ImportFile.GLOBAL.objectData.features[t].geometry,tags:ImportFile.GLOBAL.objectData.features[t].properties.Tags==undefined?null:ImportFile.GLOBAL.objectData.features[t].properties.Tags},arrayfile.push(i);ViewMap.showLoading(!0);$.ajax({type:"POST",url:ViewMap.GLOBAL.url+"/v2/api/land/update-or-insert?key="+ViewMap.CONSTS.key,data:JSON.stringify(arrayfile),dataType:"json",contentType:"application/json-patch+json",success:function(n){ViewMap.showLoading(!1);n.code=="ok"?swal({title:"Thông báo",text:"Nhập dữ liệu từ file thành công!",icon:"success",button:"Đóng"}).then(()=>{$(ImportFile.SELECTORS.modalFile).modal("hide"),$(ImportFile.SELECTORS.Input_File).val(""),$(ImportFile.SELECTORS.fileNames).text("")}):swal({title:"Thông báo",text:"Xảy ra lỗi trong quá trình nhập dữ liệu từ file",icon:"warning",button:"Đóng"}).then(()=>{$(ImportFile.SELECTORS.modalFile).modal("hide"),$(ImportFile.SELECTORS.Input_File).val(""),$(ImportFile.SELECTORS.fileNames).text("")})},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);$(ImportFile.SELECTORS.Input_File).val("");$(ImportFile.SELECTORS.fileNames).text("");ViewMap.showLoading(!1)}})}else n.preventDefault(),$(ImportFile.SELECTORS.TxtFileUploadError).text("Vui lòng chọn file")});$(document).on("change",ImportFile.SELECTORS.Input_File,()=>{var n=$(ImportFile.SELECTORS.Input_File)[0].files[0],t=new FileReader;ImportFile.GLOBAL.stringData=null;ImportFile.GLOBAL.objectData=null;t.onload=function(){ImportFile.GLOBAL.stringData=t.result};t.readAsText(n,"UTF-8");t.onloadend=function(){var f,r,t,u,i;try{if(f=n.name.toLowerCase(),r=f.split(".").pop(),r!="txt"&&r!="json"&&r!="geojson"){$(ImportFile.SELECTORS.TxtFileUploadError).text("Định dạng của tệp không được cho phép");$(ImportFile.SELECTORS.Input_File).val("");$(ImportFile.SELECTORS.fileNames).text("");return}if(n.size==0){$(ImportFile.SELECTORS.TxtFileUploadError).text("Không thể đính kém file rỗng!");$(ImportFile.SELECTORS.Input_File).val("");$(ImportFile.SELECTORS.fileNames).text("");return}if(n.size>=3145728){$(ImportFile.SELECTORS.TxtFileUploadError).text("Kích thước file quá lớn!");$(ImportFile.SELECTORS.Input_File).val("");$(ImportFile.SELECTORS.fileNames).text("");return}if(ImportFile.GLOBAL.stringData!=null&&ImportFile.GLOBAL.stringData!=undefined){if(t=JSON.parse(ImportFile.GLOBAL.stringData),console.log(t),t.features!=undefined){for(u=0,i=0;i<t.features.length;i++)if(i==u)t.features[i].properties!=undefined&&t.features[i].geometry!=undefined&&t.features[i].geometry.coordinates!=undefined&&t.features[i].properties!=null&&t.features[i].geometry.coordinates.length>0&&t.features[i].properties.MaXa!=undefined&&t.features[i].properties.MaXa!=null&&t.features[i].properties.MaXa!=""&&t.features[i].properties.SoHieuToBanDo!=undefined&&t.features[i].properties.SoHieuToBanDo!=null&&t.features[i].properties.SoHieuToBanDo!=""&&t.features[i].properties.SoThuTuThua!=undefined&&t.features[i].properties.SoThuTuThua!=null&&t.features[i].properties.SoThuTuThua!=""&&u++;else{$(ImportFile.SELECTORS.TxtFileUploadError).text("Dữ liệu JSON trong file không đúng định dạng!");$(ImportFile.SELECTORS.Input_File).val("");$(ImportFile.SELECTORS.fileNames).text("");return}$(ImportFile.SELECTORS.TxtFileUploadError).text("");$(ImportFile.SELECTORS.fileNames).text(n.name);ImportFile.GLOBAL.objectData=t;return}$(ImportFile.SELECTORS.TxtFileUploadError).text("Dữ liệu JSON trong file không đúng định dạng!");$(ImportFile.SELECTORS.Input_File).val("");$(ImportFile.SELECTORS.fileNames).text("")}}catch(e){$(ImportFile.SELECTORS.TxtFileUploadError).text("Dữ liệu trong file không phải là json!");$(ImportFile.SELECTORS.Input_File).val("");$(ImportFile.SELECTORS.fileNames).text("")}}})}};