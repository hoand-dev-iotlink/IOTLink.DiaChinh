var TachThua={GLOBAL:{ThuaDat:null,polygon:null,path:null,listMarkerDiem:[],listDiem:[],listKetQuaGhiNhan:[],maptachthua:null,listPolygonTachThua:null,listDrawPolygon:[],listInforUpdateTachThua:[],codeMaXaThuaDat:"",polylineGhiNhan:null,listSortKetQuaGhiNhan:[],polylineSelectPolygon:null},CONSTS:{},SELECTORS:{checkGiaoHoi:".giao-hoi",modalTachThua:".modal-tach-thua",btnTachThua:".btn-tach-thua",formGiaoHoi:".form-giao-hoi",noteGiaoHoi:".note-giao-hoi",menuCachDuongThang:".menu-cach-duong-thang",menuHoiThuan:".menu-hoi-thuan",menuHoiNghich:".menu-hoi-nghich",menuHoiHuong:".menu-hoi-huong",menuDocTheoCanh:".menu-doc-theo-canh",selectDinhA:"#sel_GHCDTDinhA",selectDinhB:"#sel_GHCDTDinhB",selectDinhC:"#sel_GHCDTDinhC",selectDinhD:"#sel_GHCDTDinhD",inputCachAB:"#inp_CachAB",inputCachCD:"#inp_CachCD",inputCachAC:"#inp_CanhAC",inputCachBC:"#inp_CanhBC",inputGocCAB:"#inp_GocCAB",inputGocCBA:"#inp_GocCBA",inputGocAPB:"#inp_GocAPB",inputGocAPC:"#inp_GocAPC",inputKhoangCach:"#inp_KhoangCach",radioGiaoHoiThuan:"input[name='loaiGiaoHoiThuan']",radioGiaoHoiThuanCheck:"input[name='loaiGiaoHoiThuan']:checked",radioTuDiem:"input[name='rad_tudiem']",radioTuDiemCheck:"input[name='rad_tudiem']:checked",radioDiem:"input[name='rad_diem']",radioDiemCheck:"input[name='rad_diem']:checked",titleGiaoHoi:".title-giao-hoi",showHideForm:".btn-show-hide-point",formPointMap:".footer-map-point",viewResultTachThua:".view-tach-thua",clearResultTachThua:".clear-result",saveResultTachThua:".save-tach-thua",clearAllPoint:".clear-all-point",closeInforTachThua:".header-infor span",inforTachThua:".infor-Tach-Thua",btnSaveInforTemp:".btn-save-infor-temp",inputIdInfor:"input[name='id']",SoToUpdate:".infor-Tach-Thua #text-update-soTo",SoThuaUpdate:".infor-Tach-Thua #text-update-soThua",SoToUpdateOld:".infor-Tach-Thua #text-update-soTo-old",SoThuaUpdateOld:".infor-Tach-Thua #text-update-soThua-old",DienTichUpdate:".infor-Tach-Thua #text-update-dienTich",DienTichPhapLyUpdate:".infor-Tach-Thua #text-update-dienTichPhapLy",TenChuUpdate:".infor-Tach-Thua #text-update-chuNha",DiaChiUpdate:".infor-Tach-Thua #text-update-diaChi",KHList:".infor-Tach-Thua #KH-listselectid",focusInput:".infor-Tach-Thua input",pointGhiNhan:"#pointGhiNhan",pointGhiNhanChild:"#pointGhiNhan tr"},init:function(){maptachthua=null;$(TachThua.SELECTORS.btnTachThua).on("click",function(){(maptachthua===null||typeof maptachthua=="undefined"||maptachthua==="")&&(maptachthua=new map4d.Map(document.getElementById("madTachThua"),{zoom:15,center:{lat:10.678087311284315,lng:105.08063708265138},geolocate:!0,minZoom:3,maxZoom:22,tilt:0,controls:!0,controlOptions:map4d.ControlOptions.TOP_RIGHT,accessKey:"208e1c99aa440d8bc2847aafa3bc0669"}),TachThua.GLOBAL.maptachthua=maptachthua,maptachthua.setTileUrl("http://61.28.233.229:8080/all/2d/{z}/{x}/{y}.png"),maptachthua.setTileUrl("http://61.28.233.229:8080/all/2d/{z}/{x}/{y}.png",!0),maptachthua.setPlacesEnabled(!1),maptachthua.setTileFeatureVisible(!1,!1),TachThua.setEvent(),TachThua.addSelectMucDich());TachThua.GLOBAL.codeMaXaThuaDat=ViewMap.GLOBAL.commonData.features[0].properties.MaXa;let n=ViewMap.GLOBAL.commonData.features[0].properties.SoHieuToBanDo,t=ViewMap.GLOBAL.commonData.features[0].properties.SoThuTuThua;TachThua.showTachThua(TachThua.GLOBAL.codeMaXaThuaDat,n,t);setTimeout(function(){if(TachThua.GLOBAL.path===null){let n=TachThua.GLOBAL.ThuaDat.features[0];TachThua.GLOBAL.path=TachThua.convertCoordinate(n)}TachThua.fitBoundsThuaDat(TachThua.GLOBAL.path);var n=maptachthua.getCamera();let t=n.getZoom();n.setZoom(t-1);maptachthua.setCamera(n);TachThua.setMarkerDiem(TachThua.GLOBAL.ThuaDat)},1e3);$(TachThua.SELECTORS.modalTachThua).modal("show")})},setEvent:function(){$(TachThua.SELECTORS.pointGhiNhan).sortable({stop:function(){TachThua.sortPointResult()}});$(".menu-tach-thua ul li a").click(function(){$("li a").removeClass("active");$(this).addClass("active")});$(TachThua.SELECTORS.modalTachThua).on("hide.bs.modal",function(){TachThua.removeMaker();TachThua.removerOptionDiem([1,2,3,4]);TachThua.ShowHideAll(!1);TachThua.removeDrawPolylineDiem();TachThua.GLOBAL.listKetQuaGhiNhan=[];updateListGhiNhan();TachThua.GLOBAL.polylineSelectPolygon!==null&&(TachThua.GLOBAL.polylineSelectPolygon.setMap(null),TachThua.GLOBAL.polylineSelectPolygon=null)});$(TachThua.SELECTORS.modalTachThua).on("show.bs.modal",function(){setTimeout(function(){$(TachThua.SELECTORS.menuCachDuongThang).trigger("click")},1e3)});$(TachThua.SELECTORS.menuCachDuongThang).on("click",function(){TachThua.showHtmlGiaoHoi(1);TachThua.setEventChangeAllDiem(1)});$(TachThua.SELECTORS.menuHoiThuan).on("click",function(){TachThua.showHtmlGiaoHoi(2);$(TachThua.SELECTORS.radioGiaoHoiThuan).change(function(){let n=$(TachThua.SELECTORS.radioGiaoHoiThuanCheck).val();n==="angle"&&($(TachThua.SELECTORS.inputGocCAB).removeAttr("disabled"),$(TachThua.SELECTORS.inputGocCBA).removeAttr("disabled"),$(TachThua.SELECTORS.inputCachAC).attr("disabled",""),$(TachThua.SELECTORS.inputCachBC).attr("disabled",""));n==="edge"&&($(TachThua.SELECTORS.inputGocCAB).attr("disabled",""),$(TachThua.SELECTORS.inputGocCBA).attr("disabled",""),$(TachThua.SELECTORS.inputCachAC).removeAttr("disabled"),$(TachThua.SELECTORS.inputCachBC).removeAttr("disabled"))});TachThua.setEventChangeAllDiem(2)});$(TachThua.SELECTORS.menuHoiNghich).on("click",function(){TachThua.showHtmlGiaoHoi(3);TachThua.setEventChangeAllDiem(3)});$(TachThua.SELECTORS.menuHoiHuong).on("click",function(){TachThua.showHtmlGiaoHoi(4);TachThua.setEventChangeAllDiem(4)});$(TachThua.SELECTORS.menuDocTheoCanh).on("click",function(){TachThua.showHtmlGiaoHoi(5);TachThua.setEventChangeAllDiem(5)});$(TachThua.SELECTORS.showHideForm).on("click",function(){let n=$(TachThua.SELECTORS.formPointMap).hasClass("footerHide");n?($(TachThua.SELECTORS.formPointMap).removeClass("footerHide"),$(TachThua.SELECTORS.formPointMap).addClass("footerShow"),$(this).find("i").removeClass("fa-chevron-up"),$(this).find("i").addClass("fa-chevron-down")):($(TachThua.SELECTORS.formPointMap).addClass("footerHide"),$(TachThua.SELECTORS.formPointMap).removeClass("footerShow"),$(this).find("i").removeClass("fa-chevron-down"),$(this).find("i").addClass("fa-chevron-up"))});$(TachThua.SELECTORS.viewResultTachThua).on("click",function(){var t,n;if(TachThua.sortPointResult(),TachThua.GLOBAL.listKetQuaGhiNhan.length>1){for(t=[],n=0;n<TachThua.GLOBAL.listKetQuaGhiNhan.length;n++){let i=TachThua.GLOBAL.listKetQuaGhiNhan[n].diem2000,r={x:i[1],y:i[0]};t.push(r)}TachThua.GLOBAL.listPolygonTachThua=TachThua.getPolygonsTachThua(t);TachThua.GLOBAL.listPolygonTachThua.length>0?(TachThua.drawPolygonTachThua(TachThua.GLOBAL.listPolygonTachThua),TachThua.ShowHideAll(!0),TachThua.removeDrawPolylineDiem()):swal({title:"Thông báo",text:"Điểm không hợp lệ để tách thửa!",icon:"warning",buttons:"Đóng",dangerMode:!0})}else swal({title:"Thông báo",text:"Số điểm quá ít để tách thửa!",icon:"warning",buttons:"Đóng",dangerMode:!0})});$(TachThua.SELECTORS.clearResultTachThua).on("click",function(){TachThua.ShowHideAll(!1);TachThua.drawPolylineDiem(TachThua.GLOBAL.listSortKetQuaGhiNhan)});$(TachThua.SELECTORS.closeInforTachThua).on("click",function(){TachThua.showInforUpdateTachThua(!1)});$(TachThua.SELECTORS.btnSaveInforTemp).on("click",function(){if(TachThua.checkFormInfor()){let t=$(TachThua.SELECTORS.inputIdInfor).val(),n=TachThua.GLOBAL.ThuaDat.features[0].properties.MaXa,i=Number($(TachThua.SELECTORS.SoToUpdate).val()),r=Number($(TachThua.SELECTORS.SoThuaUpdate).val()),u=TachThua.checkSoThuaSoTo(i,r,n);u?TachThua.setInforUpdateTachThua(t,n):insertError($(TachThua.SELECTORS.TenChuUpdate),"other")}});$(TachThua.SELECTORS.focusInput).on("click",function(){$(this).parent().removeClass("has-error")});$(TachThua.SELECTORS.SoThuaUpdate).on("focusout",function(){let n=Number($(TachThua.SELECTORS.SoToUpdate).val()),t=Number($(this).val()),i=TachThua.GLOBAL.ThuaDat.features[0].properties.MaXa,r=TachThua.checkSoThuaSoTo(n,t,i);r||$(TachThua.SELECTORS.SoThuaUpdate).parent().addClass("has-error")});$(TachThua.SELECTORS.saveResultTachThua).on("click",function(){if(TachThua.GLOBAL.listPolygonTachThua!==null&&TachThua.GLOBAL.listInforUpdateTachThua.length===TachThua.GLOBAL.listPolygonTachThua.length&&TachThua.GLOBAL.listInforUpdateTachThua.length>0){let t=TachThua.GLOBAL.ThuaDat.features[0].properties.info==="vn2000"?TachThua.GLOBAL.ThuaDat.features[0]:TachThua.GLOBAL.ThuaDat.features[1],i={id:t.properties.Id,objectId:t.properties.ObjectId,uuid:t.properties.UUID,thoiDiemBatDau:t.properties.ThoiDiemBatDau,thoiDiemKetThuc:t.properties.ThoiDiemKetThuc,maXa:t.properties.MaXa,maDoiTuong:t.properties.MaDoiTuong,soHieuToBanDo:t.properties.SoHieuToBanDo,soThuTuThua:t.properties.SoThuTuThua,soHieuToBanDoCu:t.properties.SoHieuToBanDoCu,soThuTuThuaCu:t.properties.SoThuTuThuaCu,dienTich:t.properties.DienTich,dienTichPhapLy:t.properties.DienTichPhapLy,kyHieuMucDichSuDung:t.properties.KyHieuMucDichSuDung,kyHieuDoiTuong:null,tenChu:t.properties.TenChu,diaChi:t.properties.DiaChi,daCapGCN:0,tenChu2:t.properties.TenChu2,namSinhC1:t.properties.NamSinhC1,soHieuGCN:t.properties.SoHieuGCN,soVaoSo:t.properties.SoVaoSo,ngayVaoSo:t.properties.NgayVaoSo,soBienNhan:t.properties.SoBienNhan,nguoiNhanHS:t.properties.NguoiNhanHS,coQuanThuLy:t.properties.CoQuanThuLy,loaiHS:t.properties.LoaiHS,maLienKet:t.properties.MaLienKet,shapeSTArea:t.properties.ShapeSTArea,shapeSTLength:t.properties.ShapeSTLength,shapeLength:t.properties.ShapeLength,shapeArea:t.properties.ShapeArea,geometry:t.geometry,tags:{}};for(var n=0;n<TachThua.GLOBAL.listInforUpdateTachThua.length;n++)TachThua.GLOBAL.listInforUpdateTachThua[n].id=TachThua.createGuid();let r={from:i,to:TachThua.GLOBAL.listInforUpdateTachThua};swal({title:"Thông báo",text:"Bạn có chắc chắn lưu thông tin và thửa đất đã tách thửa!",icon:"warning",buttons:["Hủy","Lưu lại"],dangerMode:!0}).then(n=>{n&&TachThua.saveInforTachThua(r)})}else swal({title:"Thông báo",text:"Chưa cập nhật thông tin đất!",icon:"warning",button:"Đóng"}).then(()=>{})});$(TachThua.SELECTORS.clearAllPoint).on("click",function(){TachThua.removeDrawPolylineDiem();TachThua.ShowHideAll(!1);TachThua.GLOBAL.listKetQuaGhiNhan=[];updateListGhiNhan()});maptachthua.addListener("click",n=>{let t=n.polygon.id;$(TachThua.SELECTORS.inputIdInfor).val(t);TachThua.addRemoveInforTachThua(t);TachThua.showInforUpdateTachThua(!0);$(TachThua.SELECTORS.formPointMap).addClass("footerHide");$(TachThua.SELECTORS.formPointMap).removeClass("footerShow");$(this).find("i").removeClass("fa-chevron-down");$(this).find("i").addClass("fa-chevron-up");TachThua.drawingPolyline(n.polygon.getPaths()[0])},{polygon:!0})},showTachThua:function(n,t,i){$.ajax({type:"GET",url:ViewMap.GLOBAL.url+"/v2/api/land/find-info",data:{code:n,soTo:t,soThua:i,key:ViewMap.CONSTS.key},"async":!1,success:function(n){if(n.result!==null&&typeof n.result!="undefined")if(console.log("lodat-select:",JSON.stringify(n.result)),n.result.features.length>0){let t=n.result;TachThua.removerPointDuplicate(t);TachThua.GLOBAL.ThuaDat=t;let i=TachThua.drawPolygon(TachThua.GLOBAL.ThuaDat)}else bootbox.alert("Phường/Xã này chưa có dữ liệu");else bootbox.alert("Lỗi hệ thống")},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}})},drawPolygon:function(n){let i=n.features[0],t=TachThua.convertCoordinate(n.features[0]);TachThua.GLOBAL.polygon!==null&&TachThua.GLOBAL.polygon.setMap(null);TachThua.GLOBAL.polygon=new map4d.Polygon({paths:t,fillColor:"#0000ff",fillOpacity:0,strokeColor:"#ea5252",strokeOpacity:1,strokeWidth:1,userInteractionEnabled:!1});TachThua.GLOBAL.polygon.setMap(maptachthua);TachThua.GLOBAL.path=t},convertCoordinate:function(n){let i=[];if(n.geometry.type.toLocaleLowerCase()==="polygon")return n.geometry.coordinates;if(n.geometry.type.toLocaleLowerCase()==="multipolygon"){let r=n.geometry.coordinates[0].length;for(var t=0;t<r;t++){let r=n.geometry.coordinates[0][t];i.push(r)}return i}},fitBoundsThuaDat:function(n){let i=new map4d.LatLngBounds;for(var t=0;t<n[0].length;t++)i.extend(n[0][t]);maptachthua.fitBounds(i)},showHtmlGiaoHoi:function(n){let t="",i="";$(TachThua.SELECTORS.formGiaoHoi).children().remove();$(TachThua.SELECTORS.noteGiaoHoi).children().remove();switch(n){case 1:t=`<div class="col-xs-12 col-sm-10">
                            <input type="text" class="giao-hoi" value="giaohoicachduongthang" style="display:none" />
                            <div class="form-group row">
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc1" class="col-sm-4 control-label no-padding-right">Đỉnh A</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhA"></select>
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc2" class="col-sm-4 control-label no-padding-right">Đỉnh B</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhB"></select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc1" class="col-sm-4 control-label no-padding-right">Đỉnh C</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhC"></select>
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc2" class="col-sm-4 control-label no-padding-right">Đỉnh D</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhD"></select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-xs-12 col-sm-6">
                                    <label for="form-field-9" class="col-sm-4 control-label no-padding-right">Cách AB</label>
                                    <input type="text" class="col-sm-8 input-mask-distance" placeholder="Khoảng cách (m)" id="inp_CachAB">
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <label for="form-field-9" class="col-sm-4 control-label no-padding-right">Cách CD</label>
                                    <input type="text" class="col-sm-8 input-mask-distance" placeholder="Khoảng cách (m)" id="inp_CachCD">
                                </div>
                            </div></div>
                            <div class="col-xs-12 col-sm-2">
                                <div class="chon-diem">
                                </div>
                            </div>`; i =`<img class="media-object" alt="100%x200" src="/Content/Map/images/GiaoHoi/ghcachduongthang.png" data-holder-rendered="true" style="width: 100%; display: block;">
                        <div class="caption">
                            <p>Lấy ra điểm cách đường AB, CD lần lượt các khoảng là d1 và d2. Kết quả sẽ thu được là 4 điểm 1,2,3,4.</p>
                        </div>`;$(TachThua.SELECTORS.formGiaoHoi).append(t);$(TachThua.SELECTORS.noteGiaoHoi).append(i);$(TachThua.SELECTORS.inputCachAB).inputmask("9{1,5}.9{1,5}");$(TachThua.SELECTORS.inputCachCD).inputmask("9{1,5}.9{1,5}");$(TachThua.SELECTORS.titleGiaoHoi).text("Giao hội cách đường thẳng");break;case 2:t=`<div class="col-xs-12 col-sm-8"><div class="form-group row">
                            <input type="text" class="giao-hoi" value="giaohoithuan" style="display:none" />
                            <div class="col-xs-12 col-sm-6">
                                <label for="sel_GHDoc1" class="col-sm-4 control-label no-padding-right">Đỉnh A</label>
                                <select class="col-sm-8" id="sel_GHCDTDinhA"></select>
                            </div>
                            <div class="col-xs-12 col-sm-6">
                                <label for="sel_GHDoc2" class="col-sm-4 control-label no-padding-right">Đỉnh B</label>
                                <select class="col-sm-8" id="sel_GHCDTDinhB"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-xs-12 col-sm-6">
                                <label for="form-field-9" class="col-sm-4 control-label no-padding-right">Cạnh A-C</label>
                                <input type="text" class="col-sm-8 input-mask-distance" placeholder="Độ dài cạnh (m)" id="inp_CanhAC">
                            </div>

                            <div class="col-xs-12 col-sm-6">
                                <label for="form-field-9" class="col-sm-4 control-label no-padding-right">Cạnh B-C</label>
                                <input type="text" class="col-sm-8 input-mask-distance" placeholder="Độ dài cạnh (m)" id="inp_CanhBC">
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-xs-12 col-sm-6">
                                <label for="form-field-select-1" class="col-sm-4 control-label no-padding-right">Góc CAB</label>
                                <input class="col-sm-8 input-mask-angle" type="text" id="inp_GocCAB" disabled="">
                            </div>
                            <div class="col-xs-12 col-sm-6">
                                <label for="form-field-select-1" class="col-sm-4 control-label no-padding-right">Góc CBA</label>
                                <input class="col-sm-8 input-mask-angle" type="text" id="inp_GocCBA" disabled="">
                            </div>
                        </div></div>
                        <div class="col-xs-12 col-sm-2">
                            <div class="phuong-thuc-giao-hoi-thuan">
                                <label class="control-label bolder blue">Giao hội theo</label>

                                <div class="radio">
                                    <label>
                                        <input name="loaiGiaoHoiThuan" type="radio" class="ace" value="edge" checked>
                                        <span class="lbl"> Cạnh</span>
                                    </label>
                                </div>

                                <div class="radio">
                                    <label>
                                        <input name="loaiGiaoHoiThuan" type="radio" class="ace" value="angle">
                                        <span class="lbl"> Góc</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div class="col-xs-12 col-sm-2">
                            <div class="chon-diem">
                            </div>
                        </div>`; i =`<img class="media-object"  alt="100%x200" src="/Content/Map/images/GiaoHoi/ghthuan.png" data-holder-rendered="true" style="width: 75%; display: block;">
                            <div class="caption">
                                <p>Từ hai đỉnh đã biết tọa độ cộng thêm hai số đo khác của tam giác giao hội, ta có thể tính được tọa độ điểm giao hội. Bài toán giao hội thuận luôn thu được hai kết quả: đỉnh C ở bên trái hay C' ở bên phải so với hướng cạnh gốc AB.</p>
                            </div>`;$(TachThua.SELECTORS.formGiaoHoi).append(t);$(TachThua.SELECTORS.noteGiaoHoi).append(i);$(TachThua.SELECTORS.inputCachAC).inputmask("9{1,5}.9{1,5}");$(TachThua.SELECTORS.inputCachBC).inputmask("9{1,5}.9{1,5}");$(TachThua.SELECTORS.inputGocCAB).inputmask("9{1,3}º9{1,2}'9{1,2}.9{1,2}\"");$(TachThua.SELECTORS.inputGocCBA).inputmask("9{1,3}º9{1,2}'9{1,2}.9{1,2}\"");$(TachThua.SELECTORS.titleGiaoHoi).text("Giao hội thuận");break;case 3:t=`<div class="col-xs-12 col-sm-10"><div class="form-group row">
                            <input type="text" class="giao-hoi" value="giaohoinghich" style="display:none" />
                            <div class="col-xs-12 col-sm-6">
                                <label for="sel_GHDoc1" class="col-sm-4 control-label no-padding-right">Đỉnh A</label>
                                <select class="col-sm-8" id="sel_GHCDTDinhA"></select>
                            </div>
                            <div class="col-xs-12 col-sm-6">
                                <label for="sel_GHDoc2" class="col-sm-4 control-label no-padding-right">Đỉnh B</label>
                                <select class="col-sm-8" id="sel_GHCDTDinhB"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-xs-12 col-sm-6">
                                <label for="sel_GHDoc1" class="col-sm-4 control-label no-padding-right">Đỉnh C</label>
                                <select class="col-sm-8" id="sel_GHCDTDinhC"></select>
                            </div>
                        </div>
                        <div class="form-group row">
                            <div class="col-xs-12 col-sm-6">
                                <label for="form-field-select-1" class="col-sm-4 control-label no-padding-right">Góc APB</label>
                                <input class="col-sm-8 input-mask-angle" type="text" id="inp_GocAPB">
                            </div>
                            <div class="col-xs-12 col-sm-6">
                                <label for="form-field-select-1" class="col-sm-4 control-label no-padding-right">Góc APC</label>
                                <input class="col-sm-8 input-mask-angle" type="text" id="inp_GocAPC">
                            </div>
                        </div></div>
                        <div class="col-xs-12 col-sm-2">
                            <div class="chon-diem">
                            </div>
                        </div>`; i =`<img class="media-object"  alt="100%x200" src="/Content/Map/images/GiaoHoi/GiaoHoiNghich_3DiemGoc.png" data-holder-rendered="true" style="width: 60%; display: block;">
                                <div class="caption">
                                    <p>Từ ba đỉnh đã biết tọa độ cộng thêm hai số đo góc từ điểm giao hội P ngắm về ABC, ta xác định được tọa độ điểm giao hội P. Góc giao hội sử dụng để tính toán là các góc ngược chiều kim đồng hồ.</p>
                                </div>`;$(TachThua.SELECTORS.formGiaoHoi).append(t);$(TachThua.SELECTORS.noteGiaoHoi).append(i);$(TachThua.SELECTORS.inputGocAPB).inputmask("9{1,3}º9{1,2}'9{1,2}.9{1,2}\"");$(TachThua.SELECTORS.inputGocAPC).inputmask("9{1,3}º9{1,2}'9{1,2}.9{1,2}\"");$(TachThua.SELECTORS.titleGiaoHoi).text("Giao hội nghịch");break;case 4:t=`<div class="col-xs-12 col-sm-10">
                            <input type="text" class="giao-hoi" value="giaohoihuong" style="display:none" />
                            <div class="form-group row">
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc1" class="col-sm-4 control-label no-padding-right">Đỉnh A</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhA"></select>
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc2" class="col-sm-4 control-label no-padding-right">Đỉnh B</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhB"></select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc1" class="col-sm-4 control-label no-padding-right">Đỉnh C</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhC"></select>
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc2" class="col-sm-4 control-label no-padding-right">Đỉnh D</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhD"></select>
                                </div>
                            </div></div>`; i =`<img class="media-object" alt="100%x200" src="/Content/Map/images/GiaoHoi/ghhuong.png" data-holder-rendered="true" style="width: 100%; display: block;">
                            <div class="caption">
                                <p>Điểm kết quả là giao điểm của hai đường thẳng AB và CD.</p>
                            </div>`;$(TachThua.SELECTORS.formGiaoHoi).append(t);$(TachThua.SELECTORS.noteGiaoHoi).append(i);$(TachThua.SELECTORS.titleGiaoHoi).text("Giao hội hướng");break;default:t=`<div class="col-xs-12 col-sm-10">
                            <input type="text" class="giao-hoi" value="giaohoidoctheocanh" style="display:none" />
                            <div class="form-group row">
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc1" class="col-sm-4 control-label no-padding-right">Đỉnh A</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhA"></select>
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <label for="sel_GHDoc2" class="col-sm-4 control-label no-padding-right">Đỉnh B</label>
                                    <select class="col-sm-8" id="sel_GHCDTDinhB"></select>
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-xs-12 col-sm-6">
                                    <label for="form-field-9" class="col-sm-4 control-label no-padding-right">Khoảng cách</label>
                                    <input type="text" class="col-sm-8 input-mask-distance" placeholder="Khoảng cách (m)" id="inp_KhoangCach">
                                </div>
                            </div>
                            <div class="form-group row">
                                <div class="col-xs-12 col-sm-2">
                                    <div class="control-group">
                                        <div class="radio">
                                            <label>
                                                <input name="rad_tudiem" type="radio" class="ace" value="A" checked>
                                                <span class="lbl"> Từ điểm A</span>
                                            </label>
                                        </div>

                                        <div class="radio">
                                            <label>
                                                <input name="rad_tudiem" type="radio" class="ace" value="B">
                                                <span class="lbl"> Từ điểm B</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>
                            </div></div>`; i =`<img class="media-object" alt="100%x200" src="/Content/Map/images/GiaoHoi/ghdoctheocanh.png" data-holder-rendered="true" style="width: 75%; display: block;">
                            <div class="caption">
                                <p>Lấy một điểm C trên đường thẳng AB cách đỉnh A hoặc đỉnh B một khoảng d.</p>
                            </div>`;$(TachThua.SELECTORS.formGiaoHoi).append(t);$(TachThua.SELECTORS.noteGiaoHoi).append(i);$(TachThua.SELECTORS.inputKhoangCach).inputmask("9{1,5}.9{1,5}");$(TachThua.SELECTORS.titleGiaoHoi).text("Giao hội dọc theo cạnh")}},setMarkerDiem:function(n){var i,t;TachThua.GLOBAL.listDiem=[];let f=n.features[0].geometry.type,r=n.features[0].properties.info=="wgs84"?n.features[0].geometry.coordinates[0]:n.features[1].geometry.coordinates[0],u=n.features[1].properties.info=="vn2000"?n.features[1].geometry.coordinates[0]:n.features[0].geometry.coordinates[0];if(f.toLowerCase()==="multipolygon")for(i=0;i<r.length;i++)for(t=0;t<r[i].length-1;t++){let n=r[i][t][1],f=r[i][t][0],o=new map4d.Marker({position:{lat:n,lng:f},icon:new map4d.Icon(10,10,"/Content/Map/images/iconPoint.png"),anchor:[.5,.5]});o.setMap(maptachthua);let e=(i+t+1).toString(),s=new map4d.Marker({position:{lat:n,lng:f},anchor:[.5,1],visible:!0,label:new map4d.MarkerLabel({text:e,color:"ff0000",fontSize:13}),icon:new map4d.Icon(32,32,"")});s.setMap(maptachthua);let h={markerPoint:o,markerTitelPoint:s};TachThua.GLOBAL.listMarkerDiem.push(h);let c=u[i][t][1],l=u[i][t][0],a={id:Number(e),name:"Điểm "+e,xy:{x:c,y:l},latlng:{lat:n,lng:f}};TachThua.GLOBAL.listDiem.push(a)}if(f.toLowerCase()==="polygon")for(t=0;t<r.length-1;t++){let n=r[t][1],i=r[t][0],e=new map4d.Marker({position:{lat:n,lng:i},icon:new map4d.Icon(10,10,"/images/iconPoint.png"),anchor:[.5,.5]});e.setMap(maptachthua);let f=(t+1).toString(),o=new map4d.Marker({position:{lat:n,lng:i},anchor:[.5,1],visible:!0,label:new map4d.MarkerLabel({text:f,color:"ff0000",fontSize:13}),icon:new map4d.Icon(32,32,"")});o.setMap(maptachthua);let s={markerPoint:e,markerTitelPoint:o};TachThua.GLOBAL.listMarkerDiem.push(s);let h=u[t][1],c=u[t][0],l={id:Number(f),name:"Điểm "+f,xy:{x:h,y:c},latlng:{lat:n,lng:i}};TachThua.GLOBAL.listDiem.push(l)}},removeMaker:function(){$.each(TachThua.GLOBAL.listMarkerDiem,function(n,t){t.markerPoint.setMap(null);t.markerTitelPoint.setMap(null)});TachThua.GLOBAL.listMarkerDiem=[]},setEventChangeAllDiem:function(n){let i=[],t=TachThua.getHtmlSelectDiem(i,!0);$(TachThua.SELECTORS.selectDinhA).append(t);$(TachThua.SELECTORS.selectDinhA).change(function(){if(i=[],i.push(Number($(this).val())),n==1||n==2||n==5){let i=Number($(this).val())-1,n=TachThua.GLOBAL.listDiem,r=i==0?n[n.length-1].id:n[i-1].id,u=i==n.length-1?n[0].id:n[i+1].id,f=[r,u];TachThua.removerOptionDiem([2,3,4]);t=TachThua.getHtmlSelectDiem(f,!1);$(TachThua.SELECTORS.selectDinhB).append(t)}else TachThua.removerOptionDiem([2,3,4]),t=TachThua.getHtmlSelectDiem(i,!0),$(TachThua.SELECTORS.selectDinhB).append(t)});(n==1||n==3||n==4)&&$(TachThua.SELECTORS.selectDinhB).change(function(){TachThua.removerOptionDiem([3,4]);i.push(Number($(this).val()));t=TachThua.getHtmlSelectDiem(i,!0);$(TachThua.SELECTORS.selectDinhC).append(t)});(n==1||n==4)&&$(TachThua.SELECTORS.selectDinhC).change(function(){if(n==1){let r=Number($(this).val())-1,n=TachThua.GLOBAL.listDiem,f=r==0?n[n.length-1].id:n[r-1].id,e=r==n.length-1?n[0].id:n[r+1].id,u=[];i.includes(f)==!1&&u.push(f);i.includes(e)==!1&&u.push(e);TachThua.removerOptionDiem([4]);t=TachThua.getHtmlSelectDiem(u,!1);$(TachThua.SELECTORS.selectDinhD).append(t)}else TachThua.removerOptionDiem([4]),i.push(Number($(this).val())),t=TachThua.getHtmlSelectDiem(i,!0),$(TachThua.SELECTORS.selectDinhD).append(t)})},getHtmlSelectDiem:function(n,t){let r="<option selected>- Chọn điểm -<\/option>";if(TachThua.GLOBAL.listDiem!=null&&TachThua.GLOBAL.listDiem.length>0){let u=TachThua.GLOBAL.listDiem;for(var i=0;i<u.length;i++)t?n.includes(u[i].id)==!1&&(r+='<option value="'+u[i].id+'">'+u[i].name+"<\/option>"):n.includes(u[i].id)==!0&&(r+='<option value="'+u[i].id+'">'+u[i].name+"<\/option>")}return r},removerOptionDiem:function(n){n.includes(1)&&$(TachThua.SELECTORS.selectDinhA).children().remove();let t=$(TachThua.SELECTORS.selectDinhB);n.includes(2)&&t.length>0&&$(TachThua.SELECTORS.selectDinhB).children().remove();t=$(TachThua.SELECTORS.selectDinhC);n.includes(3)&&t.length>0&&$(TachThua.SELECTORS.selectDinhC).children().remove();t=$(TachThua.SELECTORS.selectDinhD);n.includes(4)&&t.length>0&&$(TachThua.SELECTORS.selectDinhD).children().remove()},checkPointOnLine:function(n,t,i){let f=Math.round(n.x*1e4)/1e4,e=Math.round(n.y*1e4)/1e4,o=Math.round(t.x*1e4)/1e4,s=Math.round(t.y*1e4)/1e4,r=Math.round(i.x*1e4)/1e4,u=Math.round(i.y*1e4)/1e4;if(f===r&&e===u||o===r&&s===u){if(f===r&&e===u)return!0;if(o===r&&s===u)return!1}else{let r=(t.y-n.y)/(t.x-n.x),u=(t.y-i.y)/(t.x-i.x);if(r=Math.round(r*1e4)/1e4,u=Math.round(u*1e4)/1e4,(n.x>t.x&&n.x>i.x&&i.x>t.x||t.x>n.x&&t.x>i.x&&i.x>n.x)&&(n.y>t.y&&n.y>i.y&&i.y>t.y||t.y>n.y&&t.y>i.y&&i.y>n.y)&&r===u)return!0}return!1},orderClockWise:function(n){var t=n.slice(0),r=0,u=0,f,i;for($.each(t,function(n,t){r=r+t.x;u=u+t.y}),r=r/t.length,u=u/t.length,t.sort(function(n,t){let i=Math.atan2(n.y-u,n.x-r),f=Math.atan2(t.y-u,t.x-r);return i-f}),f=[],i=0;i<t.length;i++)i===t.length-1?f.push(t[i]):t[i].x!==t[i+1].x&&t[i].y!==t[i+1].y&&f.push(t[i]);return f},orderClockWiseWGS84:function(n){var r=n.slice(0),t=0,i=0;return $.each(r,function(n,r){t=t+r[0];i=i+r[1]}),t=t/r.length,i=i/r.length,r.sort(function(n,r){let u=Math.atan2(n[1]-i,n[0]-t),f=Math.atan2(r[1]-i,r[0]-t);return u-f}),r},checkListPointWithPolygon:function(n,t){var l,a,u,f,h,e,o,c,s,i,r;if(n.length>1){l=[];a=[];let p,w,b,v=!1,y=!1;for(i=0;i<t.length;i++)for((!v&&!y||v&&y)&&l.push(t[i]),v&&!y&&a.push(t[i]),r=0;r<n.length;r++)if(p=t[i].xy,w=i===t.length-1?t[0].xy:t[i+1].xy,b=n[r],TachThua.checkPointOnLine(p,w,b)){!y&&v&&(y=!0);v||(v=!0);break}if(v&&y){for(e=[],i=0;i<l.length;i++)e.push(l[i].xy);for(o=[],i=0;i<a.length;i++)o.push(a[i].xy);if(TachThua.GLOBAL.listSortKetQuaGhiNhan.length>0){if(TachThua.GLOBAL.listSortKetQuaGhiNhan.length<=2)$.each(TachThua.GLOBAL.listSortKetQuaGhiNhan,function(t,i){e.push(n[i]);o.push(n[i])});else if(TachThua.GLOBAL.listSortKetQuaGhiNhan.length>2){let t=TachThua.GLOBAL.listSortKetQuaGhiNhan[0],i=TachThua.GLOBAL.listSortKetQuaGhiNhan[TachThua.GLOBAL.listSortKetQuaGhiNhan.length-1];u=n[t];f=n[i];e.push(u);e.push(f);o.push(u);o.push(f)}}else if(n.length<=2)for(i=0;i<n.length;i++)e.push(n[i]),o.push(n[i]);else if(n.length>=2){let t=n[0],i=n[n.length-1];u=n[t];f=n[i];e.push(u);e.push(f);o.push(u);o.push(f)}if(h=[],h.push(TachThua.clockWiseNew(e)),h.push(TachThua.clockWiseNew(o)),n.length>2)for(s=0;s<h.length;s++){let t=h[s];for(i=0;i<t.length;i++){let e=i;if(t[i].x===u.x&&t[i].y===u.y)if(t[i+1].x===f.x&&t[i+1].y===f.y){for(r=1;r<TachThua.GLOBAL.listSortKetQuaGhiNhan.length-1;r++)e=e+1,t.splice(e,0,n[TachThua.GLOBAL.listSortKetQuaGhiNhan[r]]);break}else if(t[t.length-1].x===f.x&&t[t.length-1].y===f.y){for(e=t.length-1,r=TachThua.GLOBAL.listSortKetQuaGhiNhan.length-2;r>0;r--)e=e+1,t.splice(e,0,n[TachThua.GLOBAL.listSortKetQuaGhiNhan[r]]);break}if(t[i].x===f.x&&t[i].y===f.y)if(t[i+1].x===u.x&&t[i+1].y===u.y){for(r=TachThua.GLOBAL.listSortKetQuaGhiNhan.length-2;r>0;r--)e=e+1,t.splice(e,0,n[TachThua.GLOBAL.listSortKetQuaGhiNhan[r]]);break}else if(t[t.length-1].x===u.x&&t[t.length-1].y===u.y){for(e=t.length-1,r=1;r<TachThua.GLOBAL.listSortKetQuaGhiNhan.length-1;r++)e=e+1,t.splice(e,0,n[TachThua.GLOBAL.listSortKetQuaGhiNhan[r]]);break}}}return h}if(TachThua.GLOBAL.listSortKetQuaGhiNhan.length>3&&!y){for(e=[],i=0;i<t.length;i++)e.push(t[i].xy);if(o=[],TachThua.GLOBAL.listSortKetQuaGhiNhan.length>0){if(TachThua.GLOBAL.listSortKetQuaGhiNhan.length<=2)$.each(TachThua.GLOBAL.listSortKetQuaGhiNhan,function(t,i){e.push(n[i]);o.push(n[i])});else if(TachThua.GLOBAL.listSortKetQuaGhiNhan.length>2){let t=TachThua.GLOBAL.listSortKetQuaGhiNhan[0],i=TachThua.GLOBAL.listSortKetQuaGhiNhan[TachThua.GLOBAL.listSortKetQuaGhiNhan.length-1];u=n[t];f=n[i];e.push(u);e.push(f);o.push(u);o.push(f)}}else if(n.length<=2)for(i=0;i<n.length;i++)e.push(n[i]),o.push(n[i]);else if(n.length>=2){let t=n[0],i=n[n.length-1];u=n[t];f=n[i];e.push(u);e.push(f);o.push(u);o.push(f)}if(c=[],c.push(TachThua.clockWiseNew(e)),c.push(TachThua.clockWiseNew(o)),n.length>2)for(s=0;s<c.length;s++){let t=c[s];for(i=0;i<t.length;i++){let e=i;if(t[i].x===u.x&&t[i].y===u.y)if(t[i+1].x===f.x&&t[i+1].y===f.y){for(r=1;r<TachThua.GLOBAL.listSortKetQuaGhiNhan.length-1;r++)e=e+1,t.splice(e,0,n[TachThua.GLOBAL.listSortKetQuaGhiNhan[r]]);break}else if(t[t.length-1].x===f.x&&t[t.length-1].y===f.y){for(e=t.length-1,r=TachThua.GLOBAL.listSortKetQuaGhiNhan.length-2;r>0;r--)e=e+1,t.splice(e,0,n[TachThua.GLOBAL.listSortKetQuaGhiNhan[r]]);break}if(t[i].x===f.x&&t[i].y===f.y)if(t[i+1].x===u.x&&t[i+1].y===u.y){for(r=TachThua.GLOBAL.listSortKetQuaGhiNhan.length-2;r>0;r--)e=e+1,t.splice(e,0,n[TachThua.GLOBAL.listSortKetQuaGhiNhan[r]]);break}else if(t[t.length-1].x===u.x&&t[t.length-1].y===u.y){for(e=t.length-1,r=1;r<TachThua.GLOBAL.listSortKetQuaGhiNhan.length-1;r++)e=e+1,t.splice(e,0,n[TachThua.GLOBAL.listSortKetQuaGhiNhan[r]]);break}}}return c}return[]}},convertDataVN2000toWGS84:function(n){let t={code:TachThua.GLOBAL.codeMaXaThuaDat,geometry:{type:"Polygon",coordinates:[]}};t.geometry.coordinates.push(n);var i;return $.ajax({type:"POST",url:ViewMap.GLOBAL.url+"/v2/api/land/vn2000-wgs84?key="+ViewMap.CONSTS.key,data:JSON.stringify(t),dataType:"json",contentType:"application/json-patch+json","async":!1,success:function(n){i=n.result},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}}),i},getPolygonsTachThua:function(n){var i=TachThua.checkListPointWithPolygon(n,TachThua.GLOBAL.listDiem),t=[];return $.each(i,function(n,i){let r=[];for(var n=0;n<i.length;n++){let t=[];t.push(i[n].y);t.push(i[n].x);r.push(t)}let u=TachThua.convertDataVN2000toWGS84(r);t.push(u)}),t},ShowHideAll:function(n){n?(TachThua.GLOBAL.polygon.setMap(null),$.each(TachThua.GLOBAL.listMarkerDiem,function(n,t){t.markerPoint.setMap(null);t.markerTitelPoint.setMap(null)})):(TachThua.GLOBAL.polygon.setMap(maptachthua),$.each(TachThua.GLOBAL.listMarkerDiem,function(n,t){t.markerPoint.setMap(maptachthua);t.markerTitelPoint.setMap(maptachthua)}),$.each(TachThua.GLOBAL.listDrawPolygon,function(n,t){t.setMap(null)}),TachThua.GLOBAL.listDrawPolygon=[],TachThua.GLOBAL.listInforUpdateTachThua=[],TachThua.GLOBAL.polylineSelectPolygon!==null&&(TachThua.GLOBAL.polylineSelectPolygon.setMap(null),TachThua.GLOBAL.polylineSelectPolygon=null))},drawPolygonTachThua:function(n){for(var t,i=0;i<n.length;i++){let r=n[i].features;for(t=0;t<r.length;t++){if(r[t].properties.info==="wgs84"){let n=r[t].geometry.coordinates;n[0].push(n[0][0]);TachThua.GLOBAL.polygon!==null&&TachThua.GLOBAL.polygon.setMap(null);let i=new map4d.Polygon({paths:n,fillColor:"#d8eefb",fillOpacity:.5,strokeColor:"#ea5252",strokeOpacity:1,strokeWidth:1});TachThua.GLOBAL.listDrawPolygon.push(i);i.setMap(maptachthua);r[t].properties.id=i.id}if(r[t].properties.info==="vn2000"){let n=r[t].geometry.coordinates;n[0].push(n[0][0])}}}},showInforUpdateTachThua:function(n){n?($(TachThua.SELECTORS.inforTachThua).removeClass("headerHide"),$(TachThua.SELECTORS.inforTachThua).addClass("headerShow")):($(TachThua.SELECTORS.inforTachThua).addClass("headerHide"),$(TachThua.SELECTORS.inforTachThua).removeClass("headerShow"))},addRemoveInforTachThua:function(n){let t=TachThua.GLOBAL.listInforUpdateTachThua.find(t=>t.id.toString()===n.toString()),i=TachThua.getAreaPolygonTachThua(n);if(typeof t!="undefined"&&t!==null&&t.soThuTuThua>0)$(TachThua.SELECTORS.SoToUpdate).val(t.soHieuToBanDo),$(TachThua.SELECTORS.SoThuaUpdate).val(t.soThuTuThua),$(TachThua.SELECTORS.SoToUpdateOld).val(t.soHieuToBanDoCu),$(TachThua.SELECTORS.SoThuaUpdateOld).val(t.soThuTuThuaCu),$(TachThua.SELECTORS.DienTichUpdate).val(i),$(TachThua.SELECTORS.DienTichPhapLyUpdate).val(t.dienTichPhapLy),$(TachThua.SELECTORS.TenChuUpdate).val(t.tenChu),$(TachThua.SELECTORS.DiaChiUpdate).val(t.diaChi),$(TachThua.SELECTORS.KHList).val(t.kyHieuMucDichSuDung);else{let n=TachThua.GLOBAL.ThuaDat.features[0].properties;$(TachThua.SELECTORS.SoToUpdate).val(n.SoHieuToBanDo);$(TachThua.SELECTORS.SoThuaUpdate).val(0);$(TachThua.SELECTORS.SoToUpdateOld).val(n.SoHieuToBanDo);$(TachThua.SELECTORS.SoThuaUpdateOld).val(n.SoThuTuThua);$(TachThua.SELECTORS.DienTichUpdate).val(i);$(TachThua.SELECTORS.DienTichPhapLyUpdate).val(0);$(TachThua.SELECTORS.TenChuUpdate).val(n.TenChu);$(TachThua.SELECTORS.DiaChiUpdate).val(n.DiaChi);$(TachThua.SELECTORS.KHList).val(n.KyHieuMucDichSuDung)}},setInforUpdateTachThua:function(n,t){let i;i=TachThua.GLOBAL.listInforUpdateTachThua.find(t=>t.id.toString()===n.toString());TachThua.GLOBAL.listInforUpdateTachThua.length>0&&typeof i!="undefined"&&i!==null?(i.soHieuToBanDo=Number($(TachThua.SELECTORS.SoToUpdate).val()),i.soThuTuThua=Number($(TachThua.SELECTORS.SoThuaUpdate).val()),i.soHieuToBanDoCu=Number($(TachThua.SELECTORS.SoToUpdateOld).val()),i.soThuTuThuaCu=Number($(TachThua.SELECTORS.SoThuaUpdateOld).val()),i.dienTich=Number($(TachThua.SELECTORS.DienTichUpdate).val()),i.dienTichPhapLy=Number($(TachThua.SELECTORS.DienTichPhapLyUpdate).val()),i.kyHieuMucDichSuDung=$(TachThua.SELECTORS.KHList).val(),i.tenChu=$(TachThua.SELECTORS.TenChuUpdate).val(),i.diaChi=$(TachThua.SELECTORS.DiaChiUpdate).val(),i.geometry=TachThua.getGeometryById(n),swal({title:"Thông báo",text:"Cập nhật thông tin thành công!",icon:"success",button:"Đóng"})):(i={id:n,objectId:0,uuid:n,thoiDiemBatDau:null,thoiDiemKetThuc:null,maXa:t,maDoiTuong:"",soHieuToBanDo:Number($(TachThua.SELECTORS.SoToUpdate).val()),soThuTuThua:Number($(TachThua.SELECTORS.SoThuaUpdate).val()),soHieuToBanDoCu:Number($(TachThua.SELECTORS.SoToUpdateOld).val()),soThuTuThuaCu:Number($(TachThua.SELECTORS.SoThuaUpdateOld).val()),dienTich:Number($(TachThua.SELECTORS.DienTichUpdate).val()),dienTichPhapLy:Number($(TachThua.SELECTORS.DienTichPhapLyUpdate).val()),kyHieuMucDichSuDung:$(TachThua.SELECTORS.KHList).val(),kyHieuDoiTuong:"",tenChu:$(TachThua.SELECTORS.TenChuUpdate).val(),diaChi:$(TachThua.SELECTORS.DiaChiUpdate).val(),daCapGCN:0,tenChu2:"",namSinhC1:"",soHieuGCN:"",soVaoSo:"",ngayVaoSo:"",soBienNhan:0,nguoiNhanHS:"",coQuanThuLy:"",loaiHS:"",maLienKet:"",shapeSTArea:0,shapeSTLength:0,shapeLength:0,shapeArea:0,geometry:TachThua.getGeometryById(n),tags:{}},TachThua.GLOBAL.listInforUpdateTachThua.push(i),swal({title:"Thông báo",text:"Cập nhật thông tin thành công!",icon:"success",button:"Đóng"}))},getGeometryById:function(n){let i=TachThua.GLOBAL.listPolygonTachThua,r;for(var t=0;t<i.length;t++){let u=i[t].features;if(typeof u[0].properties.id!="undefined"&&u[0].properties.id.toString()===n||typeof u[1].properties.id!="undefined"&&u[1].properties.id.toString()===n){r=u[0].properties.info==="vn2000"?u[0].geometry:u[1].geometry;break}}return r},checkFormInfor:function(){let n=!0,t=$(TachThua.SELECTORS.SoThuaUpdate).val();validateText(t,"number",0,0)&&t!=="0"||(insertError($(TachThua.SELECTORS.SoThuaUpdate),"other"),n=!1);let i=$(TachThua.SELECTORS.SoToUpdate).val();validateText(i,"number",0,0)&&i!=="0"||(insertError($(TachThua.SELECTORS.SoToUpdate),"other"),n=!1);let r=$(TachThua.SELECTORS.DienTichUpdate).val();validateText(r,"float",0,0)&&r!=="0"||(insertError($(TachThua.SELECTORS.DienTichUpdate),"other"),n=!1);let u=$(TachThua.SELECTORS.DienTichPhapLyUpdate).val();validateText(u,"float",0,0)&&u!=="0"||(insertError($(TachThua.SELECTORS.DienTichPhapLyUpdate),"other"),n=!1);let f=$(TachThua.SELECTORS.TenChuUpdate).val();return validateText(f,"text",0,0)||(insertError($(TachThua.SELECTORS.TenChuUpdate),"other"),n=!1),n},saveInforTachThua:function(n){console.log(n);$.ajax({type:"POST",url:ViewMap.GLOBAL.url+"/v2/api/land/tach-thua?key="+ViewMap.CONSTS.key,data:JSON.stringify(n),dataType:"json","async":!1,contentType:"application/json-patch+json",success:function(n){n.code==="ok"&&swal({title:"Thông báo",text:"Cập nhật thông tin thửa đất thành công!",icon:"success",button:"Đóng"}).then(()=>{$(TachThua.SELECTORS.modalTachThua).modal("hide"),RemoveUrlToThua(),setTimeout(function(){location.reload()},500)})},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}})},getAreaPolygonTachThua:function(n){let r=TachThua.GLOBAL.listPolygonTachThua,t;for(var i=0;i<r.length;i++)if(t=typeof r[i].features[0].properties.id!="undefined"&&r[i].features[0].properties.id==n?r[i]:typeof r[i].features[1].properties.id!="undefined"&&r[i].features[1].properties.id==n?r[i]:null,typeof t!="undefined"&&t!==null){t=t.features[0].properties.info==="vn2000"?t.features[0]:t.features[1];break}if(typeof t!="undefined"&&t!==null){if(t.geometry.type.toLowerCase()==="polygon"){let n={points:t.geometry.coordinates[0]};return Math.abs(TachThua.calculateAreaPolygonVN2000(n))}if(t.geometry.type.toLowerCase()==="MultiPolygon"){let n={points:t.geometry.coordinates[0][0]};return Math.abs(TachThua.calculateAreaPolygonVN2000(n))}}},calculateAreaPolygonVN2000:function(n){let t=0;return $.ajax({type:"POST",url:ViewMap.GLOBAL.url+"/v2/api/land/calculate?key="+ViewMap.CONSTS.key,data:JSON.stringify(n),dataType:"json","async":!1,contentType:"application/json-patch+json",success:function(n){n.code==="ok"&&(t=Math.round(n.result.area.value*100)/100)},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}}),t},sortPointResult:function(){TachThua.GLOBAL.listSortKetQuaGhiNhan=[];$(TachThua.SELECTORS.pointGhiNhanChild).each(function(){let n=$(this).find("th").attr("data-id");typeof n!="undefined"&&n!==null&&TachThua.GLOBAL.listSortKetQuaGhiNhan.push(Number(n))});TachThua.GLOBAL.listSortKetQuaGhiNhan.length>1&&TachThua.drawPolylineDiem(TachThua.GLOBAL.listSortKetQuaGhiNhan)},drawPolylineDiem:function(n){TachThua.GLOBAL.polylineGhiNhan!==null&&(TachThua.GLOBAL.polylineGhiNhan.setMap(null),TachThua.GLOBAL.polylineGhiNhan=null);let t=[];$.each(n,function(n,i){let r=TachThua.GLOBAL.listKetQuaGhiNhan[i].diem84;t.push(r)});TachThua.GLOBAL.polylineGhiNhan=new map4d.Polyline({path:t,visible:!0,strokeColor:"#3dab21",strokeWidth:2,strokeOpacity:1,closed:!1});TachThua.GLOBAL.polylineGhiNhan.setMap(maptachthua)},removeDrawPolylineDiem:function(){TachThua.GLOBAL.polylineGhiNhan!==null&&(TachThua.GLOBAL.polylineGhiNhan.setMap(null),TachThua.GLOBAL.polylineGhiNhan=null)},createGuid:function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)})},drawingPolyline:function(n){TachThua.GLOBAL.polylineSelectPolygon!==null&&(TachThua.GLOBAL.polylineSelectPolygon.setMap(null),TachThua.GLOBAL.polylineSelectPolygon=null);let t=new map4d.Polyline({path:n,strokeColor:"#00ffff",strokeOpacity:1,strokeWidth:2});t.setMap(maptachthua);TachThua.GLOBAL.polylineSelectPolygon=t},checkSoThuaSoTo:function(n,t,i){let r=!1;return($.ajax({type:"GET",url:ViewMap.GLOBAL.url+"/v2/api/land/find-info",data:{code:i,soTo:n,soThua:t,key:ViewMap.CONSTS.key},"async":!1,success:function(n){n.result!==null&&typeof n.result!="undefined"?n.result.features.length>0?(r=!1,swal({title:"Thông báo",text:"Số Thửa này đã có trong phường/xã!",icon:"warning",buttons:"Đóng",dangerMode:!0})):r=!0:(swal({title:"Thông báo",text:"Lỗi hệ thống!",icon:"error",buttons:"Đóng",dangerMode:!0}),r=!1)},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}}),t<=0)?!1:r},removerPointDuplicate:function(n){var u,t;let r=n,e=r.features[0].geometry.type,o=r.features[0].properties.info=="vn2000"?r.features[0]:r.features[1],s=r.features[0].properties.info=="wgs84"?r.features[0]:r.features[1],f=r.features[0].properties.info=="wgs84"?r.features[0].geometry.coordinates[0]:r.features[1].geometry.coordinates[0],i=r.features[1].properties.info=="vn2000"?r.features[1].geometry.coordinates[0]:r.features[0].geometry.coordinates[0];if(e.toLowerCase()==="multipolygon")for(t=0;t<i.length;t++){let n=[],r=[];for(u=0;u<i[t].length;u++)u===i[t].length-1?(n.push(i[t][u]),r.push(f[t][u])):i[t][u][1]!==i[t][u+1][1]&&i[t][u][0]!==i[t][u+1][0]&&(n.push(i[t][u]),r.push(f[t][u]));o.geometry.coordinates[0][t]=n;s.geometry.coordinates[0][t]=r}if(e.toLowerCase()==="polygon"){let n=[],r=[];for(t=0;t<i.length;t++){let u=i[t][1],e=i[t][0];t===i.length-1?(n.push(i[t]),r.push(f[t])):i[t][1]!==i[t+1][1]&&i[t][0]!==i[t+1][0]&&(n.push(i[t]),r.push(f[t]))}o.geometry.coordinates[0]=n;s.geometry.coordinates[0]=r}return r},clockWiseNew:function(n){var t=n.slice(0),u,f,r,i;t.sort((n,t)=>n.y-t.y);const e=(t[0].y+t[t.length-1].y)/2;t.sort((n,t)=>t.x-n.x);const o=(t[0].x+t[t.length-1].x)/2;for(u={x:o,y:e},t.forEach(n=>{var t=Math.atan2(n.y-u.y,n.x-u.x);f?t<f&&(t+=Math.PI*2):f=t;n.angle=t}),t.sort((n,t)=>n.angle-t.angle),r=[],i=0;i<t.length;i++)i===t.length-1?r.push(t[i]):t[i].x!==t[i+1].x&&t[i].y!==t[i+1].y&&r.push(t[i]);return r},addSelectMucDich:function(){$.ajax({type:"GET",url:ViewMap.GLOBAL.url+"/v2/api/land/all-muc-dich-su-dung",data:{key:ViewMap.CONSTS.key},success:function(n){if(n.code=="ok"&&n.result!=null&&n.result.length>0){let i="";for(var t=0;t<n.result.length;t++)i+=`<option value="${n.result[t].mucDichSuDung}">
                                        ${n.result[t].name}
                                    </option>`;$(TachThua.SELECTORS.KHList).append(i)}else swal({title:"Thông báo",text:"Không tìm thấy thành phố địa chính",icon:"warning",button:"Đóng"}).then(()=>{})},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r)}})}};