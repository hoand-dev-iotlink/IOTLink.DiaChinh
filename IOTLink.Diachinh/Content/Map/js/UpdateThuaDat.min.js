var UpdateThuaDat={GLOBAL:{KHSelected:null},CONSTS:{},SELECTORS:{KHList:".model-update-thua-dat #KH-listselectid",SoToUpdate:".model-update-thua-dat #text-update-soTo",SoThuaUpdate:".model-update-thua-dat #text-update-soThua",SoToUpdateOld:".model-update-thua-dat #text-update-soTo-old",SoThuaUpdateOld:".model-update-thua-dat #text-update-soThua-old",DienTichUpdate:".model-update-thua-dat #text-update-dienTich",DienTichPhapLyUpdate:".model-update-thua-dat #text-update-dienTichPhapLy",TenChuUpdate:".model-update-thua-dat #text-update-chuNha",DiaChiUpdate:".model-update-thua-dat #text-update-diaChi",btnUpdateThuaDat:".model-update-thua-dat #btn-update-thua-dat",modalUpdate:".model-update-thua-dat"},init:function(){UpdateThuaDat.setEvent();UpdateThuaDat.addSelectDistrict()},setEvent:function(){$(ToolShape.SELECTORS.btnUpdateShape).on("click",function(){if(ViewMap.GLOBAL.ThuaDatSelect!=null)UpdateThuaDat.getFindInfo(ViewMap.GLOBAL.ThuaDatSelect[0].ObjectId),UpdateThuaDat.GLOBAL.KHSelected!=null&&($(UpdateThuaDat.SELECTORS.KHList).val(UpdateThuaDat.GLOBAL.KHSelected.properties.KyHieuMucDichSuDung).change(),($(UpdateThuaDat.SELECTORS.KHList).val()==""||$(UpdateThuaDat.SELECTORS.KHList).val()==null)&&($(UpdateThuaDat.SELECTORS.KHList).attr("disabled","disabled"),$(UpdateThuaDat.SELECTORS.KHList).append(`<option value="${UpdateThuaDat.GLOBAL.KHSelected.properties.KyHieuMucDichSuDung}"> 
                                       ${UpdateThuaDat.GLOBAL.KHSelected.properties.KyHieuMucDichSuDung} 
                                  </option>`),$(UpdateThuaDat.SELECTORS.KHList).val(UpdateThuaDat.GLOBAL.KHSelected.properties.KyHieuMucDichSuDung).change()),$(UpdateThuaDat.SELECTORS.SoToUpdate).val(UpdateThuaDat.GLOBAL.KHSelected.properties.SoHieuToBanDo),$(UpdateThuaDat.SELECTORS.SoThuaUpdate).val(UpdateThuaDat.GLOBAL.KHSelected.properties.SoThuTuThua),$(UpdateThuaDat.SELECTORS.SoToUpdateOld).val(UpdateThuaDat.GLOBAL.KHSelected.properties.SoHieuToBanDoCu),$(UpdateThuaDat.SELECTORS.SoToUpdateOld).val()==""&&$(UpdateThuaDat.SELECTORS.SoToUpdateOld).val("0"),$(UpdateThuaDat.SELECTORS.SoThuaUpdateOld).val(UpdateThuaDat.GLOBAL.KHSelected.properties.SoThuTuThuaCu),$(UpdateThuaDat.SELECTORS.SoThuaUpdateOld).val()==""&&$(UpdateThuaDat.SELECTORS.SoThuaUpdateOld).val("0"),$(UpdateThuaDat.SELECTORS.DienTichUpdate).val(UpdateThuaDat.GLOBAL.KHSelected.properties.DienTich),$(UpdateThuaDat.SELECTORS.DienTichPhapLyUpdate).val(UpdateThuaDat.GLOBAL.KHSelected.properties.DienTichPhapLy),$(UpdateThuaDat.SELECTORS.TenChuUpdate).val(UpdateThuaDat.GLOBAL.KHSelected.properties.TenChu),$(UpdateThuaDat.SELECTORS.DiaChiUpdate).val(UpdateThuaDat.GLOBAL.KHSelected.properties.DiaChi),$(UpdateThuaDat.SELECTORS.modalUpdate).modal("show"));else{swal({title:"Thông báo",text:"Không tìm thấy dữ liệu",icon:"warning",button:"Đóng"}).then(()=>{});return}});$(UpdateThuaDat.SELECTORS.btnUpdateThuaDat).on("click",function(){var n=$(UpdateThuaDat.SELECTORS.SoToUpdate).val(),t=$(UpdateThuaDat.SELECTORS.SoThuaUpdate).val(),i=$(UpdateThuaDat.SELECTORS.SoToUpdateOld).val(),r=$(UpdateThuaDat.SELECTORS.SoThuaUpdateOld).val(),u=$(UpdateThuaDat.SELECTORS.DienTichUpdate).val(),f=$(UpdateThuaDat.SELECTORS.DienTichPhapLyUpdate).val(),o=$(UpdateThuaDat.SELECTORS.TenChuUpdate).val(),s=$(UpdateThuaDat.SELECTORS.DiaChiUpdate).val(),h=$(UpdateThuaDat.SELECTORS.KHList).val();if(n===""||t===""||i===""||r===""||u===""||f===""){swal({title:"Thông báo",text:"Dữ liệu nhập không đúng",icon:"warning",button:"Đóng"}).then(()=>{});return}var c=parseFloat(u),l=parseFloat(f),e={id:UpdateThuaDat.GLOBAL.KHSelected.properties.Id,objectId:ViewMap.GLOBAL.ThuaDatSelect[0].ObjectId,index:UpdateThuaDat.GLOBAL.KHSelected.properties.Index,uuid:UpdateThuaDat.GLOBAL.KHSelected.properties.UUID,thoiDiemBatDau:UpdateThuaDat.GLOBAL.KHSelected.properties.ThoiDiemBatDau,thoiDiemKetThuc:UpdateThuaDat.GLOBAL.KHSelected.properties.ThoiDiemKetThuc,maXa:UpdateThuaDat.GLOBAL.KHSelected.properties.MaXa,maDoiTuong:UpdateThuaDat.GLOBAL.KHSelected.properties.MaDoiTuong,soHieuToBanDo:n,soThuTuThua:t,soHieuToBanDoCu:i,soThuTuThuaCu:r,dienTich:c,dienTichPhapLy:l,kyHieuMucDichSuDung:h,kyHieuDoiTuong:UpdateThuaDat.GLOBAL.KHSelected.properties.KyHieuDoiTuong,tenChu:o,diaChi:s,daCapGCN:UpdateThuaDat.GLOBAL.KHSelected.properties.DaCapGCN,tenChu2:UpdateThuaDat.GLOBAL.KHSelected.properties.TenChu2,namSinhC1:UpdateThuaDat.GLOBAL.KHSelected.properties.NamSinhC1,soHieuGCN:UpdateThuaDat.GLOBAL.KHSelected.properties.SoHieuGCN,soVaoSo:UpdateThuaDat.GLOBAL.KHSelected.properties.SoVaoSo,ngayVaoSo:UpdateThuaDat.GLOBAL.KHSelected.properties.NgayVaoSo,soBienNhan:UpdateThuaDat.GLOBAL.KHSelected.properties.SoBienNhan,nguoiNhanHS:UpdateThuaDat.GLOBAL.KHSelected.properties.NguoiNhanHS,coQuanThuLy:UpdateThuaDat.GLOBAL.KHSelected.properties.CoQuanThuLy,loaiHS:UpdateThuaDat.GLOBAL.KHSelected.properties.LoaiHS,maLienKet:UpdateThuaDat.GLOBAL.KHSelected.properties.MaLienKet,shapeSTArea:UpdateThuaDat.GLOBAL.KHSelected.properties.ShapeSTArea,shapeSTLength:UpdateThuaDat.GLOBAL.KHSelected.properties.ShapeSTLength,shapeLength:UpdateThuaDat.GLOBAL.KHSelected.properties.ShapeLength,shapeArea:UpdateThuaDat.GLOBAL.KHSelected.properties.ShapeArea,geometry:UpdateThuaDat.GLOBAL.KHSelected.geometry,tags:UpdateThuaDat.GLOBAL.KHSelected.properties.Tags};console.log(e);ViewMap.showLoading(!0);$.ajax({type:"POST",url:ViewMap.GLOBAL.url+"/v2/api/land/update?key="+ViewMap.CONSTS.key,data:JSON.stringify(e),dataType:"json","async":!1,contentType:"application/json-patch+json",success:function(i){i.code=="ok"&&swal({title:"Thông báo",text:"Cập nhật thông tin thửa đất thành công!",icon:"success",button:"Đóng"}).then(()=>{UpdateThuaDat.updateThuaDat(parseInt(n),parseInt(t)),$(UpdateThuaDat.SELECTORS.modalUpdate).modal("hide")})},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}})});$(UpdateThuaDat.SELECTORS.DienTichUpdate).keyup(function(){var i=$(this).val(),n=i.split("."),t;if(n.length>2){for(t=2;t<n.length;t++)n[1]+=n[t];$(this).val(n[0]+"."+n[1])}});$(UpdateThuaDat.SELECTORS.DienTichPhapLyUpdate).keyup(function(){var i=$(this).val(),n=i.split("."),t;if(n.length>2){for(t=2;t<n.length;t++)n[1]+=n[t];$(this).val(n[0]+"."+n[1])}})},getFindInfo:function(n){ViewMap.showLoading(!0);$.ajax({type:"GET",url:ViewMap.GLOBAL.url+"/v2/api/land/find-info",data:{code:ViewMap.CONSTS.codeDefault,objectId:n,key:ViewMap.CONSTS.key},"async":!1,success:function(n){console.log(n);n.code=="ok"&&n.result!=null&&n.result.features.length>0?(console.log(n.result.features),UpdateThuaDat.GLOBAL.KHSelected=n.result.features.find(n=>n.properties.info==="vn2000")):swal({title:"Thông báo",text:"Không tìm thấy kết quả",icon:"warning",button:"Đóng"}).then(()=>{});ViewMap.showLoading(!1)},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}})},updateThuaDat:function(n,t){ViewMap.showLoading(!0);$.ajax({type:"GET",url:ViewMap.GLOBAL.url+"/v2/api/land/find",data:{code:ViewMap.CONSTS.codeDefault,soTo:n,soThua:t,key:ViewMap.CONSTS.key},success:function(n){if(console.log(n),n.code=="ok"&&n.result!=null&&n.result.features.length>0){let t=n.result.features[0].properties;$(ViewMap.SELECTORS.MaXa).text(t.MaXa);$(ViewMap.SELECTORS.TenChu).text(t.TenChu);$(ViewMap.SELECTORS.DiaChi).text(t.DiaChi);$(ViewMap.SELECTORS.SoThuaBD).text(t.SoThuTuThua);$(ViewMap.SELECTORS.SoToBD).text(t.SoHieuToBanDo);$(ViewMap.SELECTORS.SoThuaOld).text(t.SoThuTuThuaCu!=null?t.SoThuTuThuaCu:0);$(ViewMap.SELECTORS.SoToOld).text(t.SoHieuToBanDoCu!=null?t.SoHieuToBanDoCu:0);$(ViewMap.SELECTORS.DientichBD).text(t.DienTich);$(ViewMap.SELECTORS.DientichPL).text(t.DienTichPhapLy);$(ViewMap.SELECTORS.KHDTC).text(t.KyHieuDoiTuong);$(ViewMap.SELECTORS.MucDichSuDung).text(t.KyHieuMucDichSuDung);$(ViewMap.SELECTORS.NameMucDichSuDung).text(t.TenMucDichSuDung);ViewMap.showHideViewProperty(!0)}else swal({title:"Thông báo",text:"Không tìm thấy kết quả",icon:"warning",button:"Đóng"}).then(()=>{});ViewMap.showLoading(!1)},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}})},addSelectDistrict:function(){$.ajax({type:"GET",url:ViewMap.GLOBAL.url+"/v2/api/land/all-muc-dich-su-dung",data:{key:ViewMap.CONSTS.key},success:function(n){if(n.code=="ok"&&n.result!=null&&n.result.length>0){let i="";for(var t=0;t<n.result.length;t++)i+=`<option value="${n.result[t].mucDichSuDung}">
                                        ${n.result[t].name}
                                    </option>`;$(UpdateThuaDat.SELECTORS.KHList).append(i)}else swal({title:"Thông báo",text:"Không tìm thấy thành phố địa chính",icon:"warning",button:"Đóng"}).then(()=>{})},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r)}})}};