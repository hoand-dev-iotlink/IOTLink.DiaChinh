function updateListGhiNhan(){$(buttonTachThua.selector.listGhiNhan).children().remove();let n="";removeMarkerGhinhans();for(let t=0;t<TachThua.GLOBAL.listKetQuaGhiNhan.length;t++){let i="";switch(TachThua.GLOBAL.listKetQuaGhiNhan[t].phuongThuc){case"giaohoicachduongthang":i="Giao hội cách đường thẳng";break;case"giaohoithuan":i="Giao hội thuận";break;case"giaohoinghich":i="Giao hội nghịch";break;case"giaohoihuong":i="Giao hội hướng";break;case"giaohoidoctheocanh":i="Giao hội dọc theo cạnh"}n+=`
            <tr>
                <th scope="row" data-id="${t}">${t+1}</th>
                <td>${i}</td>
            </tr>
        `;let r=new map4d.Marker({position:TachThua.GLOBAL.listKetQuaGhiNhan[t].diem84,anchor:[.5,.5],visible:!0,labelAnchor:[.5,-1],label:new map4d.MarkerLabel({text:"Giao điểm "+(t+1),color:"ff0000",fontSize:13}),icon:new map4d.Icon(10,10,"/Content/Map/images/iconPoint.png")});r.setMap(TachThua.GLOBAL.maptachthua);buttonTachThua.global.listMarkerGhiNhan.push(r)}$(buttonTachThua.selector.listGhiNhan).html(n);TachThua.removeDrawPolylineDiem()}function getGocRadian(n){return n===""?null:(deg=parseInt(n.substring(0,n.indexOf("º")).replace("_","0")),min=parseInt(n.substring(n.indexOf("º")+1,n.indexOf("'")).replace("_","0")),sec=parseFloat(n.substring(n.indexOf("'")+1,n.indexOf('"')).replace("_","0")),degval=deg+min/60+sec/3600,degval*Math.PI/180)}function convertVN2000ToWGS84(n,t){$.ajax({url:ViewMap.GLOBAL.url+"/v2/api/land/vn2000-wgs84?key="+ViewMap.CONSTS.key,type:"POST","async":!0,contentType:"application/json",data:JSON.stringify({code:TachThua.GLOBAL.codeMaXaThuaDat,geometry:{type:"MultiPoint",coordinates:convertListPointTo2000(n)}}),success:function(n){t(n)},error:function(n,t,i){let r=AppCommon.getMessageErrorReuqest(n,i);console.log(r);ViewMap.showLoading(!1)}})}function removeMarkers(){for(let n=0;n<buttonTachThua.global.listMarker.length;n++)buttonTachThua.global.listMarker[n].setMap(null);buttonTachThua.global.listMarker=[]}function removeMarkerGhinhans(){for(let n=0;n<buttonTachThua.global.listMarkerGhiNhan.length;n++)buttonTachThua.global.listMarkerGhiNhan[n].setMap(null);buttonTachThua.global.listMarkerGhiNhan=[]}var buttonTachThua={global:{list2000:[],list84:[],validate:{valid:!0,error:""},listMarker:[],listMarkerGhiNhan:[]},selector:{xemThu:"#btn_Preview",chonDiem:".form-giao-hoi .chon-diem",error:".error",ghiNhan:"#btn_Submit",notification:".notification",listGhiNhan:".table-point tbody"},reset:function(){$(buttonTachThua.selector.error).remove();$(buttonTachThua.selector.notification).remove();removeMarkers();buttonTachThua.global.list84=[];buttonTachThua.global.list2000=[];buttonTachThua.global.validate={valid:!0,error:""};$(buttonTachThua.selector.chonDiem).children().remove()}};$(function(){$(".menu-tach-thua>ul").click(function(){buttonTachThua.reset()});$(buttonTachThua.selector.xemThu).click(function(){buttonTachThua.reset();let t=$(TachThua.SELECTORS.checkGiaoHoi).val(),n;if(t==="giaohoicachduongthang"){let o=parseInt($(TachThua.SELECTORS.selectDinhA).val()),t=TachThua.GLOBAL.listDiem.find(function(n){return n.id===o}),s=parseInt($(TachThua.SELECTORS.selectDinhB).val()),i=TachThua.GLOBAL.listDiem.find(function(n){return n.id===s}),h=parseInt($(TachThua.SELECTORS.selectDinhC).val()),r=TachThua.GLOBAL.listDiem.find(function(n){return n.id===h}),c=parseInt($(TachThua.SELECTORS.selectDinhD).val()),u=TachThua.GLOBAL.listDiem.find(function(n){return n.id===c}),f=parseFloat($(TachThua.SELECTORS.inputCachAB).val().replace("_","0")),e=parseFloat($(TachThua.SELECTORS.inputCachCD).val().replace("_","0"));t&&i&&r&&u&&f&&e||(buttonTachThua.global.validate.valid=!1,buttonTachThua.global.validate.error="Dữ liệu đầu vào chưa đủ");buttonTachThua.global.validate.valid&&(n=giaoHoiCachDuongThang(t.xy,i.xy,r.xy,u.xy,f,e))}if(t==="giaohoithuan"){let r=$(TachThua.SELECTORS.radioGiaoHoiThuanCheck).val(),u=parseInt($(TachThua.SELECTORS.selectDinhA).val()),t=TachThua.GLOBAL.listDiem.find(function(n){return n.id===u}),f=parseInt($(TachThua.SELECTORS.selectDinhB).val()),i=TachThua.GLOBAL.listDiem.find(function(n){return n.id===f});if(r==="edge"){let r=parseFloat($(TachThua.SELECTORS.inputCachAC).val().replace("_","0")),u=parseFloat($(TachThua.SELECTORS.inputCachBC).val().replace("_","0"));t&&i&&r&&u||(buttonTachThua.global.validate.valid=!1,buttonTachThua.global.validate.error="Dữ liệu đầu vào chưa đủ");buttonTachThua.global.validate.valid&&(n=giaoHoiThuanTheoCanh(t.xy,r,i.xy,u))}if(r==="angle"){let r=getGocRadian($(TachThua.SELECTORS.inputGocCAB).val()),u=getGocRadian($(TachThua.SELECTORS.inputGocCBA).val());t&&i&&r&&u||(validate.valid=!1,validate.error="Dữ liệu đầu vào chưa đủ");r&&u&&r+u>=Math.PI&&(buttonTachThua.global.validate.valid=!1,buttonTachThua.global.validate.error="Tổng hai góc nhập vào phải nhỏ hơn 180º");buttonTachThua.global.validate.valid&&(n=giaoHoiThuanTheoGoc(t.xy,i.xy,r,u))}}if(t==="giaohoinghich"){let e=parseInt($(TachThua.SELECTORS.selectDinhA).val()),r=TachThua.GLOBAL.listDiem.find(function(n){return n.id===e}),o=parseInt($(TachThua.SELECTORS.selectDinhB).val()),u=TachThua.GLOBAL.listDiem.find(function(n){return n.id===o}),s=parseInt($(TachThua.SELECTORS.selectDinhC).val()),f=TachThua.GLOBAL.listDiem.find(function(n){return n.id===s}),t=getGocRadian($(TachThua.SELECTORS.inputGocAPB).val()),i=getGocRadian($(TachThua.SELECTORS.inputGocAPC).val());r&&u&&f&&t&&i||(buttonTachThua.global.validate.valid=!1,buttonTachThua.global.validate.error="Dữ liệu đầu vào chưa đủ");t&&i&&(t>=Math.PI||i>=Math.PI)&&(buttonTachThua.global.validate.valid=!1,buttonTachThua.global.validate.error="Góc nhập vào phải nhỏ hơn 180º");buttonTachThua.global.validate.valid&&(n=giaoHoiNghich(r.xy,u.xy,f.xy,t,i))}if(t==="giaohoihuong"){let f=parseInt($(TachThua.SELECTORS.selectDinhA).val()),t=TachThua.GLOBAL.listDiem.find(function(n){return n.id===f}),e=parseInt($(TachThua.SELECTORS.selectDinhB).val()),i=TachThua.GLOBAL.listDiem.find(function(n){return n.id===e}),o=parseInt($(TachThua.SELECTORS.selectDinhC).val()),r=TachThua.GLOBAL.listDiem.find(function(n){return n.id===o}),s=parseInt($(TachThua.SELECTORS.selectDinhD).val()),u=TachThua.GLOBAL.listDiem.find(function(n){return n.id===s});t&&i&&r&&u||(buttonTachThua.global.validate.valid=!1,buttonTachThua.global.validate.error="Dữ liệu đầu vào chưa đủ");buttonTachThua.global.validate.valid&&(n=giaoHoiHuong(t.xy,i.xy,r.xy,u.xy))}if(t==="giaohoidoctheocanh"){let r=parseInt($(TachThua.SELECTORS.selectDinhA).val()),t=TachThua.GLOBAL.listDiem.find(function(n){return n.id===r}),u=parseInt($(TachThua.SELECTORS.selectDinhB).val()),i=TachThua.GLOBAL.listDiem.find(function(n){return n.id===u}),f=parseFloat($(TachThua.SELECTORS.inputKhoangCach).val().replace("_","0"));t&&i||(buttonTachThua.global.validate.valid=!1,buttonTachThua.global.validate.error="Dữ liệu đầu vào chưa đủ");let e=$(TachThua.SELECTORS.radioTuDiemCheck).val()==="B";buttonTachThua.global.validate.valid&&(n=giaoHoiDocTheoCanh(t.xy,i.xy,f,e))}buttonTachThua.global.validate.valid&&!n&&(buttonTachThua.global.validate.valid=!1,buttonTachThua.global.validate.error="Không tìm thấy điểm nào thỏa mãn, hãy kiểm tra lại dữ liệu");buttonTachThua.global.validate.valid||$(TachThua.SELECTORS.formGiaoHoi).append(`
                <div class="col-xs-12 error">
                    <p class="text-danger">${buttonTachThua.global.validate.error}</p>
                </div>
            `);n&&convertVN2000ToWGS84(n,function(t){if(t.code==="ok"){t.result.features[0].properties.info==="vn2000"?(buttonTachThua.global.list2000=t.result.features[0].geometry.coordinates,buttonTachThua.global.list84=t.result.features[1].geometry.coordinates):(buttonTachThua.global.list2000=t.result.features[1].geometry.coordinates,buttonTachThua.global.list84=t.result.features[0].geometry.coordinates);for(let n=0;n<buttonTachThua.global.list84.length;n++){let t=new map4d.Marker({position:buttonTachThua.global.list84[n],anchor:[.5,.5],visible:!0,labelAnchor:[.5,-1],label:new map4d.MarkerLabel({text:"Điểm "+(n+1),color:"ff0000",fontSize:13}),icon:new map4d.Icon(10,10,"/Content/Map/images/iconPoint.png")});t.setMap(TachThua.GLOBAL.maptachthua);buttonTachThua.global.listMarker.push(t)}if(n.length===1)$(TachThua.SELECTORS.formGiaoHoi).append(`
                            <div class="col-xs-12 notification">
                                <p class="text-primary">Tìm thấy 1 điểm duy nhất</p>
                            </div>
                        `);else{$(TachThua.SELECTORS.formGiaoHoi).append(`
                            <div class="col-xs-12 notification">
                                <p class="text-primary">Tìm thấy ${n.length} điểm thỏa mãn, vui lòng chọn điểm</p>
                            </div>
                        `);let t="";for(let n=0;n<buttonTachThua.global.list84.length;n++)t+=`
                                <div class="radio">
                                    <label>
                                        <input name="rad_diem" type="radio" class="ace" value="${n}">
                                        <span class="lbl"> Điểm ${n+1}</span>
                                    </label>
                                </div>
                            `;$(buttonTachThua.selector.chonDiem).html(t)}}})});$(buttonTachThua.selector.ghiNhan).click(function(){if(buttonTachThua.global.list84.length===0&&($(buttonTachThua.selector.error).remove(),$(TachThua.SELECTORS.formGiaoHoi).append(`
                 <div class="col-xs-12 error">
                     <p class="text-danger">Không có điểm nào để ghi nhận!</p>
                 </div>
             `)),buttonTachThua.global.list84.length===1){let n=$(TachThua.SELECTORS.checkGiaoHoi).val(),t={phuongThuc:n,diem84:buttonTachThua.global.list84[0],diem2000:buttonTachThua.global.list2000[0]};TachThua.GLOBAL.listKetQuaGhiNhan.push(t);buttonTachThua.reset();updateListGhiNhan()}if(buttonTachThua.global.list84.length>1){let t=$(TachThua.SELECTORS.checkGiaoHoi).val(),n=$(TachThua.SELECTORS.radioDiemCheck).val();if(n!=undefined){let i={phuongThuc:t,diem84:buttonTachThua.global.list84[n],diem2000:buttonTachThua.global.list2000[n]};TachThua.GLOBAL.listKetQuaGhiNhan.push(i);buttonTachThua.reset();updateListGhiNhan()}else $(buttonTachThua.selector.error).remove(),$(TachThua.SELECTORS.formGiaoHoi).append(`
                    <div class="col-xs-12 error">
                        <p class="text-danger">Hãy chọn điểm trước khi ghi nhận!</p>
                    </div>
                `)}})});